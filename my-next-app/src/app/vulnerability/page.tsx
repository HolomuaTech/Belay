'use client';
import { Box, Drawer, List, ListItem, ListItemIcon, ListItemText, ListItemButton, Typography, Breadcrumbs, Link } from '@mui/material';
import { DataGrid, GridColDef } from '@mui/x-data-grid';
// Add some icons for the drawer (you'll need to install @mui/icons-material)
import { Button } from '@mui/material';
import NavigateNextIcon from '@mui/icons-material/NavigateNext';
import SideMenu from '@/components/SideMenu';
import { useRef } from 'react';

// Sample data
const rows = [
  { id: 1, Vulnerability: 'vulnerability 1', Severity: 'Severity 1', CVSS: 7.5, EPSS: 0.45, Info: 'Info 1' },
  { id: 2, Vulnerability: 'vulnerability 2', Severity: 'Severity 2', CVSS: 4.2, EPSS: 0.12, Info: 'Info 2' },
  { id: 3, Vulnerability: 'vulnerability 3', Severity: 'Severity 3', CVSS: 9.1, EPSS: 0.89, Info: 'Info 3' },
];

const columns: GridColDef[] = [
  { field: 'id', headerName: 'ID', width: 90 },
  { field: 'Vulnerability', headerName: 'Vulnerability', width: 130 },
  { field: 'Severity', headerName: 'Severity', width: 130 },
  { field: 'CVSS', headerName: 'CVSS', width: 60, type: 'number' },
  { 
    field: 'EPSS', 
    headerName: 'EPSS', 
    width: 60, 
    type: 'number', 
    valueFormatter: (params) => typeof params.value === 'number' ? params.value.toFixed(2) : '0.00'
  },
  { field: 'Info', headerName: 'Info', width: 90 },
  {
    field: 'actions',
    headerName: 'Actions',
    width: 200,
    renderCell: (params) => (
      <Box>
        <Button 
          variant="contained" 
          size="small" 
          sx={{ mr: 1 }}
          title="Add to whitelist"
          onClick={(event) => {
            event.stopPropagation();
            console.log('Whitelist clicked for row:', params.row.id);
          }}
        >
          Whitelist
        </Button>
        <Button 
          variant="contained" 
          size="small"
          title="Create POAM"
          onClick={(event) => {
            event.stopPropagation();
            console.log('POAM clicked for row:', params.row.id);
          }}
        >
          POAM
        </Button>
      </Box>
    ),
  },
];

const drawerWidth = 240;

export default function Vulnerability() {

  return (
    <Box sx={{ display: 'flex' }}>
      <SideMenu />

      <Box sx={{ 
        flexGrow: 1, 
        p: 3,
        height: '100vh', 
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'flex-start',
        backgroundColor: '#f5f5f5'
      }}>
        <Typography 
          variant="h4" 
          sx={{ 
            mb: 2,
            color: 'black'
          }}
        >
          Vulnerability Management
        </Typography>
        
        <Breadcrumbs 
          separator={<NavigateNextIcon fontSize="small" />}
          sx={{ mb: 3 }}
        >
          <Link 
            underline="hover" 
            color="inherit" 
            href="#" 
            sx={{ '&:hover': { cursor: 'pointer' } }}
          >
            Project
          </Link>
          <Link 
            underline="hover" 
            color="inherit" 
            href="#" 
            sx={{ '&:hover': { cursor: 'pointer' } }}
          >
            Repository
          </Link>
          <Link 
            underline="hover" 
            color="inherit" 
            href="#" 
            sx={{ '&:hover': { cursor: 'pointer' } }}
          >
            main
          </Link>
        </Breadcrumbs>
        <Box 
            sx={{ 
                backgroundColor: 'background.paper',
                p: 2,
                mb: 2,
                borderRadius: 1,
                boxShadow: 1
            }}
        >
            <Typography 
                variant="h6" 
                sx={{ color: 'text.primary', mb: 2 }}
            >
                Description:
            </Typography>
            <Typography 
                variant="body1" 
                sx={{ color: 'text.primary' }}
            >
                Manage vulnerabilities in your repository.  Changes to the whitelist will be reflected in the whitelist file in the repository.  Additionally, the whitelist will be saved in the enterprise database for analytics.
            </Typography>
        </Box>
        <Box sx={{ 
          backgroundColor: 'white', 
          padding: 2, 
          borderRadius: 1,
          width: '100%',
          boxShadow: 1
        }}>
          <Button 
            variant="contained" 
            sx={{ mb: 2 }}
            onClick={() => console.log('Upload artifact clicked')}
          >
            Upload Artifact
          </Button>
          
          <div style={{ height: 600, width: '100%' }}>
            <DataGrid
              rows={rows}
              columns={columns}
              initialState={{
                pagination: {
                  paginationModel: { pageSize: 5, page: 0 },
                },
              }}
              pageSizeOptions={[5]}
              disableRowSelectionOnClick
            />
          </div>
        </Box>
      </Box>
    </Box>
  );
}